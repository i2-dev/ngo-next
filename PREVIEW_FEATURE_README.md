# é¢„è§ˆåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†å®Œæ•´çš„Strapiå†…å®¹é¢„è§ˆåŠŸèƒ½ï¼Œæ”¯æŒå¤šç§é¢„è§ˆæ–¹å¼å’Œå†…å®¹ç±»å‹ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šç§é¢„è§ˆæ ¼å¼æ”¯æŒ**ï¼šStrapiæ ‡å‡†æ ¼å¼ã€ç®€åŒ–æ ¼å¼ã€ç›´æ¥è®¿é—®
- âœ… **å®æ—¶æ•°æ®è·å–**ï¼šä»Strapi APIè·å–æœ€æ–°çš„é¢„è§ˆæ•°æ®
- âœ… **é¢„è§ˆæ¨ªå¹…**ï¼šæ˜¾ç¤ºé¢„è§ˆçŠ¶æ€å’Œç›¸å…³ä¿¡æ¯
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æç¤ºå’Œå¤„ç†æœºåˆ¶
- âœ… **å“åº”å¼è®¾è®¡**ï¼šé€‚é…å„ç§è®¾å¤‡å°ºå¯¸
- âœ… **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒenã€zhã€hkã€tcç­‰è¯­è¨€

## é¢„è§ˆæ–¹å¼

### 1. Strapiæ ‡å‡†é¢„è§ˆæ ¼å¼

å½“ä»Strapiæ¥æ”¶åˆ°ä»¥ä¸‹æ ¼å¼çš„é¢„è§ˆè¯·æ±‚æ—¶ï¼š

```
http://192.168.15.200:3000/api/preview?secret=efee254c6a8b119e65057678ffa7cf8b2e701d83407596eb813d187c2959c087&slug=y529m3uaz2v9rknwy21lg373&uid=api::about-us.about-us&status=draft&documentId=y529m3uaz2v9rknwy21lg373&locale=en
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. éªŒè¯secretå‚æ•°
2. è¯†åˆ«å†…å®¹ç±»å‹ï¼ˆabout-usï¼‰
3. é‡å®šå‘åˆ°å¯¹åº”çš„é¢„è§ˆé¡µé¢

### 2. ç®€åŒ–é¢„è§ˆæ ¼å¼

ä½¿ç”¨ç®€åŒ–çš„URLæ ¼å¼ï¼š

```
http://192.168.15.200:3000/api/preview-simple?page=aboutus&locale=en&status=draft
```

### 3. ç›´æ¥é¢„è§ˆè®¿é—®

ç›´æ¥è®¿é—®é¢„è§ˆé¡µé¢ï¼š

```
http://192.168.15.200:3000/preview/about-us?status=draft&locale=en
```

## APIç«¯ç‚¹

### é¢„è§ˆAPIè·¯ç”±

- **`/api/preview`** - å¤„ç†Strapiæ ‡å‡†é¢„è§ˆè¯·æ±‚
- **`/api/preview-simple`** - å¤„ç†ç®€åŒ–é¢„è§ˆè¯·æ±‚

### é¢„è§ˆé¡µé¢

- **`/preview/about-us`** - å…³äºæˆ‘ä»¬é¡µé¢é¢„è§ˆ
- **`/preview/contact-us`** - è”ç³»æˆ‘ä»¬é¡µé¢é¢„è§ˆï¼ˆå¾…å®ç°ï¼‰
- **`/preview/homepage`** - é¦–é¡µé¢„è§ˆï¼ˆå¾…å®ç°ï¼‰

## æ•°æ®è·å–

### Strapi APIç«¯ç‚¹

é¢„è§ˆåŠŸèƒ½ä»ä»¥ä¸‹Strapi APIè·å–æ•°æ®ï¼š

```
http://strapi2-dev.dev.i2hk.net/api/about-us?status=draft
```

### æ•°æ®æ ¼å¼

è¿”å›çš„æ•°æ®æ ¼å¼ç¤ºä¾‹ï¼š

```json
{
  "data": {
    "id": 1,
    "documentId": "y529m3uaz2v9rknwy21lg373",
    "Title": "é—œæ–¼æˆ‘å€‘123456",
    "RightContent": "<h2>å±•å»¶NGO: æ“´ã€Œå±•ã€é—œæ‡·ã€ã€Œå»¶ã€çºŒæœå‹™</h2>...",
    "LeftImage": [...],
    "OurClients": [...],
    "createdAt": "2025-07-30T07:28:45.407Z",
    "updatedAt": "2025-08-20T09:23:27.894Z",
    "publishedAt": null,
    "locale": "en"
  },
  "meta": {}
}
```

## ç»„ä»¶ç»“æ„

### æ ¸å¿ƒç»„ä»¶

1. **`PreviewWrapper`** - é€šç”¨é¢„è§ˆåŒ…è£…ç»„ä»¶
   - æ˜¾ç¤ºé¢„è§ˆæ¨ªå¹…
   - å¤„ç†åŠ è½½çŠ¶æ€
   - é”™è¯¯å¤„ç†
   - è‡ªåŠ¨éšè—åŠŸèƒ½

2. **`AboutUsPreview`** - å…³äºæˆ‘ä»¬é¢„è§ˆé¡µé¢
   - è·å–å’Œæ˜¾ç¤ºå…³äºæˆ‘ä»¬æ•°æ®
   - æ¸²æŸ“é¡µé¢å†…å®¹
   - æ˜¾ç¤ºé¢„è§ˆä¿¡æ¯

### å·¥å…·å‡½æ•°

1. **`preview-data-fetcher.js`** - é¢„è§ˆæ•°æ®è·å–å·¥å…·
   - `fetchPreviewData()` - ä»Strapiè·å–é¢„è§ˆæ•°æ®
   - `getPreviewData()` - è·å–ç‰¹å®šå†…å®¹ç±»å‹æ•°æ®
   - `validatePreviewParams()` - éªŒè¯é¢„è§ˆå‚æ•°
   - `formatPreviewData()` - æ ¼å¼åŒ–é¢„è§ˆæ•°æ®

## ä½¿ç”¨æ–¹æ³•

### 1. åœ¨Strapiä¸­é…ç½®é¢„è§ˆURL

åœ¨Strapiç®¡ç†é¢æ¿ä¸­ï¼Œä¸ºabout-uså†…å®¹ç±»å‹é…ç½®é¢„è§ˆURLï¼š

```
http://192.168.15.200:3000/api/preview?secret=efee254c6a8b119e65057678ffa7cf8b2e701d83407596eb813d187c2959c087&slug={{documentId}}&uid=api::about-us.about-us&status=draft&documentId={{documentId}}&locale={{locale}}
```

### 2. æµ‹è¯•é¢„è§ˆåŠŸèƒ½

è®¿é—®æµ‹è¯•é¡µé¢ï¼š

```
http://192.168.15.200:3000/test-preview
```

### 3. ç›´æ¥è®¿é—®é¢„è§ˆ

```
http://192.168.15.200:3000/preview/about-us?status=draft&locale=en
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# é¢„è§ˆå¯†é’¥ï¼ˆå¯é€‰ï¼‰
PREVIEW_SECRET=efee254c6a8b119e65057678ffa7cf8b2e701d83407596eb813d187c2959c087

# Strapi API Tokenï¼ˆå¯é€‰ï¼‰
STRAPI_API_TOKEN=your_strapi_api_token_here
```

### Strapié…ç½®

åœ¨Strapiçš„`config/plugins.js`ä¸­é…ç½®é¢„è§ˆæŒ‰é’®ï¼š

```javascript
module.exports = {
  'preview-button': {
    config: {
      contentTypes: [
        {
          uid: 'api::about-us.about-us',
          draft: {
            url: 'http://192.168.15.200:3000/api/preview?secret=efee254c6a8b119e65057678ffa7cf8b2e701d83407596eb813d187c2959c087&slug={{documentId}}&uid=api::about-us.about-us&status=draft&documentId={{documentId}}&locale={{locale}}',
          },
          published: {
            url: 'http://192.168.15.200:3000/{{locale}}/aboutus',
          },
        },
      ],
    },
  },
};
```

## æ‰©å±•å…¶ä»–å†…å®¹ç±»å‹

è¦æ·»åŠ å…¶ä»–å†…å®¹ç±»å‹çš„é¢„è§ˆæ”¯æŒï¼š

1. **åˆ›å»ºé¢„è§ˆé¡µé¢**ï¼šåœ¨`app/preview/`ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„é¢„è§ˆé¡µé¢
2. **æ›´æ–°æ•°æ®è·å–å·¥å…·**ï¼šåœ¨`preview-data-fetcher.js`ä¸­æ·»åŠ æ–°çš„å†…å®¹ç±»å‹æ˜ å°„
3. **æ›´æ–°APIè·¯ç”±**ï¼šåœ¨`/api/preview`å’Œ`/api/preview-simple`ä¸­æ·»åŠ æ–°çš„å†…å®¹ç±»å‹å¤„ç†

### ç¤ºä¾‹ï¼šæ·»åŠ è”ç³»æˆ‘ä»¬é¢„è§ˆ

1. åˆ›å»º`app/preview/contact-us/page.js`
2. åœ¨`preview-data-fetcher.js`ä¸­æ·»åŠ contact-usæ˜ å°„
3. æ›´æ–°APIè·¯ç”±å¤„ç†contact-uså†…å®¹ç±»å‹

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é¢„è§ˆæ•°æ®åŠ è½½å¤±è´¥**
   - æ£€æŸ¥Strapi APIæ˜¯å¦å¯è®¿é—®
   - ç¡®è®¤APIç«¯ç‚¹æ­£ç¡®
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **é¢„è§ˆé¡µé¢æ˜¾ç¤ºé”™è¯¯**
   - æ£€æŸ¥URLå‚æ•°æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤å†…å®¹ç±»å‹æ˜ å°„æ­£ç¡®
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

3. **é¢„è§ˆæ¨ªå¹…ä¸æ˜¾ç¤º**
   - æ£€æŸ¥PreviewWrapperç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å…¥
   - ç¡®è®¤CSSæ ·å¼æ­£ç¡®åŠ è½½

### è°ƒè¯•æ–¹æ³•

1. **æŸ¥çœ‹ç½‘ç»œè¯·æ±‚**ï¼šåœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹APIè¯·æ±‚
2. **æ£€æŸ¥æ§åˆ¶å°**ï¼šæŸ¥çœ‹JavaScripté”™è¯¯ä¿¡æ¯
3. **æµ‹è¯•APIç«¯ç‚¹**ï¼šç›´æ¥è®¿é—®Strapi APIéªŒè¯æ•°æ®
4. **ä½¿ç”¨æµ‹è¯•é¡µé¢**ï¼šè®¿é—®`/test-preview`è¿›è¡ŒåŠŸèƒ½æµ‹è¯•

## æ›´æ–°æ—¥å¿—

### v1.0.1 (2025-01-27)
- ğŸ”§ ä¿®å¤é‡å®šå‘URLé—®é¢˜ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å¤–éƒ¨URLè€Œä¸æ˜¯localhost
- ğŸ”§ æ›´æ–°é¢„è§ˆæ•°æ®è·å–å·¥å…·ï¼Œä½¿ç”¨pLevel=5å‚æ•°
- âœ… æ”¹è¿›URLå¤„ç†é€»è¾‘

### v1.0.0 (2025-01-27)
- âœ… å®ç°åŸºç¡€é¢„è§ˆåŠŸèƒ½
- âœ… æ”¯æŒå…³äºæˆ‘ä»¬é¡µé¢é¢„è§ˆ
- âœ… åˆ›å»ºé€šç”¨é¢„è§ˆç»„ä»¶
- âœ… å®ç°å¤šç§é¢„è§ˆæ ¼å¼æ”¯æŒ
- âœ… æ·»åŠ é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
- âœ… åˆ›å»ºæµ‹è¯•é¡µé¢å’Œæ–‡æ¡£

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. è®¿é—®æµ‹è¯•é¡µé¢è¿›è¡ŒåŠŸèƒ½éªŒè¯
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
4. è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒ
